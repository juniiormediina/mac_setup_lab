#!/bin/bash

# Mostrar el directorio de trabajo actual
echo "=================================================================================================================="
echo "PATH: $(pwd)"
echo "=================================================================================================================="

# Ejecutar pruebas y generar cobertura
echo "=================================================================================================================="
echo "Ejecutando pruebas y generando cobertura..."
echo "=================================================================================================================="
flutter test --coverage

# Filtrar archivos excluidos
echo "=================================================================================================================="
echo "Filtrando archivos excluidos de la cobertura..."
echo "=================================================================================================================="
lcov --remove coverage/lcov.info 'lib/infrastructure/driven_adapters/*' 'lib/infrastructure/entry_points/ui/screens/*' -o coverage/lcov_filtered.info

# Generar reporte HTML
echo "=================================================================================================================="
echo "Generando reporte HTML de la cobertura..."
echo "=================================================================================================================="
genhtml coverage/lcov_filtered.info -o coverage/html && open coverage/html/index.html

echo "=================================================================================================================="
echo "Proceso completado."
echo "=================================================================================================================="